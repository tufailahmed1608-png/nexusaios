trigger: none

stages:
- stage: Deploy_Production
  displayName: Deploy PRODUCTION
  environment: production
  jobs:
    - template: templates/deploy-infrastructure.yml
      parameters:
        environment: prod
        azureSubscription: azure-subscription-prod
        location: westeurope
        templateFile: infrastructure/azure/main.bicep
        parametersFile: infrastructure/azure/parameters/prod.bicepparam
        deploymentName: nexus-prod-$(Build.BuildId)

    - template: templates/deploy-frontend.yml
      parameters:
        environment: prod
        azureSubscription: azure-subscription-prod

    - template: templates/health-check.yml
      parameters:
        environment: prod
