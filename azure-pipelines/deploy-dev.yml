trigger:
  branches:
    include:
      - develop

stages:
- stage: Build
  jobs:
    - template: templates/build.yml

- stage: Infra
  dependsOn: Build
  jobs:
    - template: templates/deploy-infrastructure.yml
      parameters:
        environment: dev
        azureSubscription: azure-subscription-dev
        location: westeurope
        templateFile: infrastructure/azure/main.bicep
        parametersFile: infrastructure/azure/parameters/dev.bicepparam
        deploymentName: nexus-dev-$(Build.BuildId)

- stage: Frontend
  dependsOn: Infra
  jobs:
    - template: templates/deploy-frontend.yml
      parameters:
        environment: dev
        azureSubscription: azure-subscription-dev
