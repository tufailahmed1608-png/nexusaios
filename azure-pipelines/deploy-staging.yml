trigger:
  branches:
    include:
      - main

stages:
- stage: Deploy_Staging
  displayName: Deploy STAGING
  environment: staging
  jobs:
    - template: templates/deploy-infrastructure.yml
      parameters:
        environment: staging
        azureSubscription: azure-subscription-staging
        location: westeurope
        templateFile: infrastructure/azure/main.bicep
        parametersFile: infrastructure/azure/parameters/staging.bicepparam
        deploymentName: nexus-staging-$(Build.BuildId)

    - template: templates/deploy-frontend.yml
      parameters:
        environment: staging
        azureSubscription: azure-subscription-staging

    - template: templates/e2e-tests.yml
      parameters:
        environment: staging
